<%- include("../partials/header") %>

<h1 class="display-2">
    <%= debate.topic %>
</h1>
<p class="lead">
    <%= debate.summary %>
</p>
<p>
    <%= debate.category %> - <em><%= moment(debate.createdAt).calendar() %></em>
</p>

<!-- NEW LAYOUT -->
<% if(currentUser && debate.moderator.id.equals(currentUser._id)) { %>
    <div class="moderator-functions">
        <p>Moderator functions</p>
        <div class="moderator-buttons">
            <a class="btn btn-outline-info" href="/debates/<%= debate._id %>/for/<%=debate.for._id %>/edit"> edit for </a>
            <a class="btn btn-outline-info" href="/debates/<%= debate._id %>/for/<%=debate.against._id %>/edit"> edit against </a>
            <form class="col text-center delete-form" action="/debates/<%= debate._id %>?_method=DELETE" method="POST">
                <button class="btn btn-outline-danger"> *** DELETE DEBATE *** </button>
            </form>
        </div>
    </div>
<% } %>
<div class="debate-section">
    <% if(debate.for && debate.against) { %>
        <div class="argument">
            <h3 class="argument-for">the case for...</h3>
            <p class="argument-author">
                <em>by <%= debate.for.author %></em>
            </p>
            <p class="argument-content">
                <%= debate.for.content %>
            </p>
        </div>
        <div class="argument">
            <h3 class="argument-against">the case against...</h3>
            <p class="argument-author">
                <em>by <%= debate.against.author %></em>
            </p>
            <p class="argument-content">
                <%= debate.against.content %>
            </p>
        </div>
    <% } else { %>
        <div class="coming-soon">
            <p>Debate coming soon.</p>
            <% if(currentUser && debate.moderator.id.equals(currentUser._id)) { %>
                <div class="moderator-debate-content">
                    <p class="col-sm-12">Add new arguments</p>
                    <a href="/debates/<%=debate._id%>/for/new" class="col btn btn-outline-warning">For</a>
                    <a href="/debates/<%=debate._id%>/against/new" class="col btn btn-outline-warning">Against</a>
                </div>
            <% } %>
        </div>
    <% } %>
</div>
<p class="moderator-title"><em>moderator - <%= debate.moderator.username %></em></p>

<div class="discussion">
    <h3>Discuss</h3>
    <div class="discussion-join">
        <a href="/debates/<%= debate._id %>/discussion/new" id="joinDiscBtn">Join the discussion</a>
    </div>
    <% debate.comments.forEach(function(comment){ %>
        <div class="comment-item">
            <div class="comment-body">
                <%= comment.text %>
            </div>
            <div class="comment-author">
                - <em><%= comment.author.username %></em>
            </div>
            <% if(currentUser && comment.author.id.equals(currentUser._id)|| currentUser && debate.moderator.id.equals(currentUser._id)){ %>
                <a href="/debates/<%=debate._id%>/discussion/<%=comment._id%>/edit" class="btn btn-sm btn-outline-warning">EDIT</a>
                <form class="delete-form" action="/debates/<%=debate._id%>/discussion/<%=comment._id%>?_method=DELETE" method="POST">
                    <input class="btn btn-sm btn-outline-danger" type="submit" value="DELETE">
                </form>
            <% } %>
        </div>
    <%})%>
</div>


<%- include("../partials/footer") %>
